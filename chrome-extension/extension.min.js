function appendTool(node){const editorNode=getEditorNode();const toolbar=editorNode.querySelector("[id$=_top]");editorNode.querySelector(".cke_toolbar_last").classList.remove("cke_toolbar_last");const tmp=CKEDITORtemplate();const parent=tmp.querySelector("[append_here]");tmp.classList.add("cke_toolbar_last");parent.appendChild(node);toolbar.appendChild(tmp);}
function CKEDITOR_frame(preffix,suffix){const editor=getEditor();editor.focus();const range=getRange();const elem=editor.document.createElement("text");const pref=new CKEDITOR.dom.element(document.createTextNode(preffix));const suff=new CKEDITOR.dom.element(document.createTextNode(suffix));elem.append(pref);elem.append(range.cloneContents());elem.append(suff);editor.insertElement(elem);editor.resetDirty();}
function CKEDITOR_insertText(text){const editor=getEditor();editor.focus();editor.insertText(text);}
function CKEDITOR_frameHtml(node,options={}){const editor=getEditor();editor.focus();const range=getRange();let childs=range.cloneContents().getChildren();let onReplace=false;let textContent="";for(let i=0;i<childs.count();i++){let isHTML=childs.getItem(i).$.innerHTML;if(isHTML){if(options["className"]&&isHTML.indexOf(options["className"])){onReplace=true;let tmp=document.createElement("span");tmp.innerHTML=isHTML;textContent+=tmp.textContent;}}}
var elem;if(onReplace){elem=editor.document.createElement("text");elem.appendText(textContent);}else{elem=editor.document.createElement(node);for(let key in options)elem.$[key]=options[key];elem.append(range.cloneContents());}
editor.insertElement(elem);editor.resetDirty();return!onReplace;}
function CKEDITORtemplate(){const root=document.createElement("span");root.className="cke_toolbar";root.innerHTML=`
        <span class="cke_toolbar_start"></span>
        <span class="cke_toolgroup">
            <a class="cke_button cke_button__source cke_button_off" href="javascript:void(0)">
                <span class="cke_button_icon cke_button__source_icon" append_here="">
                </span>
            </a>
        </span>
        <span class="cke_toolbar_end"></span>
    `;return root;}
const TOOLS=[newButton("TeX",function(ev){const onReload=CKEDITOR_frameHtml("span",{className:"math-tex"});if(onReload){const editor=getEditor();editor.setMode("source",function(){editor.setMode("wysiwyg");});}}),newSelection("HS Tags",["PRE","TITLE","ALERT-primary","HINT","META"],function(ev){let preffix=`[${ev.target.value}]`,suffix="";switch(ev.target.value){case"ALERT-primary":suffix=`[/ALERT]`;break;default:suffix=`[/${ev.target.value}]`;}
CKEDITOR_frame(preffix,suffix);})];function getRange(){const editor=getEditor();return editor.getSelection().getRanges()[0];}
function getEditorID(){return Object.keys(CKEDITOR.instances)[0];}
function getEditor(){return CKEDITOR.instances[getEditorID()];}
function getEditorNode(){return document.querySelector("#cke_"+getEditorID());}
function newButton(title,callback){const parent=document.createElement("div");parent.className="hs-tool";parent.innerHTML=`
        <span class="hs-button">
            ${title}
        </span>
    `;parent.addEventListener("click",callback);return parent;}
function newSelection(title,options=[],callback){const parent=document.createElement("div");parent.className="hs-tool";const select=document.createElement("select");parent.appendChild(select);const titleOption=new Option(title,"",true,true);select.append(titleOption)
for(let option of options){select.append(new Option(option,option,false,false))}
select.addEventListener("change",function(ev){callback(ev);ev.target.value="";});return parent;}
function hsIcon(width=28,height=28,stroke=false){let buffer=document.createElement("div");buffer.innerHTML=`<svg data-v-1f85fa9f="" width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-icon align-middle" data-component-name="alt-logo-icon" style="height: ${height}px; width: ${width}px;"><path fill="#fff" stroke="${stroke ? "#484848" : "#fff"}" stroke-width="2" d="M1 1h26v26H1z"></path><path d="M26 3v23H3L26 3z" fill="#484848"></path><path fill="#fff" d="M16 20h7v2h-7z"></path></svg>`;return buffer.firstChild;}
function Xicon(width=10,height=10){let buffer=document.createElement("div");buffer.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width: ${width}px; height: ${height}px;"> <use xlink:href="/static/frontend-build/icons.svg?1662371064#close"></use></svg>`;return buffer.firstChild;}
function hsToolbar(){const parent=document.createElement("div");parent.className="hs-toolbar-extend";const closeBtn=document.createElement("div");closeBtn.className="hs-tool-close";closeBtn.appendChild(Xicon(10,10));parent.appendChild(closeBtn);const toolContent=document.createElement("div");toolContent.className="hs-tool-content";parent.appendChild(toolContent);for(let tool of TOOLS)toolContent.appendChild(tool);closeBtn.addEventListener("click",function(ev){ev.stopPropagation();parent.classList.remove("active");});;return parent;}
function hsOpenButton(){const parent=document.createElement("div");parent.id="hs-ext-tool";parent.className="hs-toolbar";parent.appendChild(hsIcon(16,16,true));const toolbar=hsToolbar();parent.appendChild(toolbar);parent.addEventListener("click",(ev)=>{toolbar.classList.add("active");})
return parent;}
const style = document.createElement("style");
style.appendChild(document.createTextNode(`@charset "utf-8";.hs-toolbar{width:16px !important;height:16px !important;position:relative !important}.hs-toolbar-extend{display:none}.hs-toolbar-extend.active{height:28px;padding:6px;position:absolute;top:-6px;left:-6px;background:#fff;box-sizing:border-box;display:flex;flex-direction:row;flex-wrap:nowrap;border:solid 1px #c9c9c9;border-radius:.375rem}.hs-toolbar-extend.active:hover{border-color:#5d72e9}.cke_button_off:hover,.cke_button_off:active,.cke_button_off:focus{border:solid 1px #5d72e9 !important;border-radius:.375rem}.hs-tool-close{display:flex;justify-content:center;align-items:center;width:16px;height:16px;margin-right:3px;border-radius:100px}.hs-tool-close:hover{background-color:#c8c8c8}.hs-tool-content{height:16px;display:flex;flex-direction:row}.hs-tool{display:flex;align-items:center;justify-content:center;margin:0 4px}.hs-tool select,.hs-tool .hs-button{background:#eee;border-radius:.375em}.hs-tool .hs-button{cursor:pointer;padding:.5px 5px}`));
document.body.appendChild(style);
