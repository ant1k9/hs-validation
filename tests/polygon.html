<style>
    #hse-helper {
        position: fixed;
        top: 20px;
        left: 20px;
        width: 250px;
        height: 300px;
        display: flex;
        flex-direction: column;
        user-select: none;
    }
    #hse-helper .hse-h-header {
        width: 100%;
        height: 26px;
        background-color: rgb(61, 64, 64);
        display: flex;
        flex-direction: row;
        align-items: center;
        border-radius: 10px 10px 0px 0px;
        padding: 0px 7px;
        box-sizing: border-box;
    }
    		
    #hse-helper .hse-h-control {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 6px;
    }

    #hse-helper .hse-h-minimize {
        background-color: rgb(254,176,36);
        position: relative;
    }
        #hse-helper .hse-h-minimize:active {
            background-color: rgb(251, 235, 116);
        }
        #hse-helper .hse-h-minimize:before {
            content: "";
            position: absolute;
            width: 8px;
            height: 2px;
            left: 2px;
            top: 5px;
        }
        #hse-helper .hse-h-header:hover .hse-h-minimize:before {
            background-color: rgb(168, 115, 41);
        }
    #hse-helper .hse-h-hide {
        background-color: rgb(237, 106, 94);
        position: relative;
    }
        #hse-helper .hse-h-hide:active {
            background-color: rgb(240, 147, 136);
        }
        #hse-helper .hse-h-hide:before, 
        #hse-helper .hse-h-hide:after {
            content: "";
            position: absolute;
            width: 8px;
            height: 2px;
            left: 2px;
            top: 5px;
        }
        #hse-helper .hse-h-hide:before {transform: rotate(45deg);}
        #hse-helper .hse-h-hide:after {transform: rotate(-45deg);}
        #hse-helper .hse-h-header:hover .hse-h-hide:before,
        #hse-helper .hse-h-header:hover .hse-h-hide:after {
            background-color: rgb(143, 28, 19);
        }

    #hse-helper .hse-h-main {
        width: 100%;
        height: calc(100% - 20px);
        background-color: rgb(43, 45, 45);
        border-radius: 0px 0px 10px 10px;
        padding: 7px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    #hse-helper button {
        border: solid 1px rgb(121, 122, 122);
        background-color: rgb(103, 104, 104);
        color: whitesmoke;
        padding: 2px;
        border-radius: 5px;
        margin: 5px;
        box-sizing: border-box;	
    }

    #hse-helper button:active {
        background-color: rgb(125, 126, 127);
    }

    iframe {
        width: 200px;
        height: 200px;
    }
</style>

<body>
    <div id="hse-helper">
        <div class="hse-h-header">
            <div class="hse-h-minimize hse-h-control"></div>
            <div class="hse-h-hide hse-h-control"></div>
        </div>
        <div class="hse-h-main">
            <button action="newTopic">Topic structure</button>
            <button action="newComprehension">Comprehension structure</button>
            <button action="newApplication">Application structure</button>
        </div>
    </div>
    <iframe> </iframe>
    <script>
        const iframe = document.querySelector("iframe");
        iframe.contentWindow.document.body.contentEditable = true

        const parent = document.querySelector("#hse-helper");
        const header = parent.querySelector(".hse-h-header");

        var onMove = false;
        var sx, sy, dx, dy;
        header.addEventListener("mousedown", (ev)=>{
            dx = header.getBoundingClientRect().x - ev.clientX;
            dy = header.getBoundingClientRect().y - ev.clientY;

            window.addEventListener("mousemove", moveElem);
        })

        function moveElem(ev) {
            parent.style.left = ev.clientX + dx;
            parent.style.top = ev.clientY + dy;

            let xy = boundsXY(parent, 10);
            parent.style.left = xy[0];
            parent.style.top = xy[1];
        }
        
        window.addEventListener("mouseup", (ev)=>{
            window.removeEventListener("mousemove", moveElem);
        })

        function boundsXY(elem, pad=0) {
            const maxWidth = document.body.clientWidth - pad;
            const maxHeight = document.body.clientHeight - pad;

            const rect = elem.getBoundingClientRect();

            var result = [rect.x, rect.y];
            
            if (rect.x < pad) result[0] = pad;
            if (rect.x+rect.width > maxWidth) result[0] = maxWidth - rect.width;
            if (rect.y < pad) result[1] = pad;
            if (rect.y+rect.height > maxHeight) result[1] = maxHeight - rect.height;
            
            return result;
        }

        document.body.addEventListener("mouseleave", (ev)=>{
            window.removeEventListener("mousemove", moveElem);
        })

        parent.querySelector("button[action=newTopic]")
            .addEventListener("click", (ev)=>{
                iframe.contentWindow.document.body.innerHTML = newTopicTemplate;
            })

        const newTopicTemplate = `
        <p>[PRE]</p>
        <ul>
            <li><a href="#" rel="noopener noreferrer nofollow">?</a></li>
        </ul>
        <p>Group: Golang -- ?</p>
        <p>[/PRE]</p>
        <p>
            [META]Intro section[/META]
        </p>

        <h2>Section 1</h2>
        <p>[META]Text[/META]</p>

        <h2>Section 2</h2>
        <p>[META]Text[/META]</p>

        <h2>Section 3</h2>
        <p>[META]Text[/META]</p>

        <h2>Conclusion</h2>
        <p>[META]Text[/META]</p>

        <ul>
            <li>...</li>
        </ul>
        `;
    </script>
</body>